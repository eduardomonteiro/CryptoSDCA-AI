{% extends "base.html" %}

{% block title %}Trading History - CryptoSDCA-AI{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1><i class="fas fa-history"></i> Trading History</h1>
            
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-list"></i> Trade History</h5>
                </div>
                <div class="card-body">
                    <div id="tradeHistory">
                        <div class="text-center">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Load trading history on page load
document.addEventListener('DOMContentLoaded', function() {
    loadTradeHistory();
});

async function loadTradeHistory() {
    try {
        const response = await fetch('/admin/api/history');
        const trades = await response.json();
        displayTradeHistory(trades);
    } catch (error) {
        console.error('Error loading trade history:', error);
    }
}

function displayTradeHistory(trades) {
    const container = document.getElementById('tradeHistory');
    
    if (trades.length === 0) {
        container.innerHTML = '<p class="text-muted text-center">No trading history available</p>';
        return;
    }
    
    const html = trades.map(trade => `
        <div class="card mb-3">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <h6>${trade.pair || 'N/A'}</h6>
                        <p class="text-muted mb-1">${trade.side || 'N/A'}</p>
                    </div>
                    <div class="col-md-3">
                        <p class="mb-1"><strong>Size:</strong> ${trade.size || 'N/A'}</p>
                        <p class="mb-1"><strong>Price:</strong> ${trade.price || 'N/A'}</p>
                    </div>
                    <div class="col-md-3">
                        <p class="mb-1"><strong>Status:</strong> 
                            <span class="badge bg-${trade.status === 'closed' ? 'success' : trade.status === 'open' ? 'warning' : 'secondary'}">
                                ${trade.status || 'N/A'}
                            </span>
                        </p>
                        <p class="mb-1"><strong>P&L:</strong> 
                            <span class="text-${trade.pnl >= 0 ? 'success' : 'danger'}">
                                ${trade.pnl ? trade.pnl.toFixed(2) : 'N/A'}
                            </span>
                        </p>
                    </div>
                    <div class="col-md-3">
                        <p class="mb-1"><strong>Created:</strong> ${trade.created_at ? new Date(trade.created_at).toLocaleString() : 'N/A'}</p>
                        <p class="mb-1"><strong>Updated:</strong> ${trade.updated_at ? new Date(trade.updated_at).toLocaleString() : 'N/A'}</p>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
    
    container.innerHTML = html;
}
</script>
{% endblock %}